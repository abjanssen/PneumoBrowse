"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7348],{67348:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var r=n(7552),a=n(68446),o=n(36422),s=n(75785),i=n(35723);const l=(0,s.n9)()({overlay:{display:"flex",width:"100%",gridArea:"1/1","& path":{cursor:"crosshair",fill:"none"}}}),c=(0,a.observer)((function({model:e}){const{classes:t}=l(),{matchedTracks:n,interactToggled:a}=e,o=(0,r.useRef)(null);return r.createElement("div",{className:t.overlay},r.createElement("svg",{ref:o,style:{width:"100%",zIndex:10,pointerEvents:a?void 0:"none"}},n.map((t=>r.createElement(i.A,{parentRef:o,key:t.configuration.trackId,model:e,trackId:t.configuration.trackId})))))})),u=(0,s.n9)()((e=>({viewDivider:{background:e.palette.secondary.main,height:3},container:{display:"grid"},content:{gridArea:"1/1"}}))),d=(0,a.observer)((function({model:e}){const{classes:t}=u(),{views:n}=e,{pluginManager:a}=(0,o.getEnv)(e);return r.createElement("div",{className:t.content},r.createElement("div",{style:{position:"relative"}},n.map(((e,o)=>{const{ReactComponent:s}=a.getViewType(e.type),i=r.createElement(s,{key:e.id,model:e});return o===n.length-1?i:[i,r.createElement("div",{key:`${e.id}-divider`,className:t.viewDivider})]}))))})),g=(0,a.observer)((function({model:e}){const{classes:t}=u();return r.createElement("div",null,r.createElement("div",{className:t.container},r.createElement(d,{model:e}),r.createElement(c,{model:e})))}))},35723:(e,t,n)=>{n.d(t,{A:()=>T});var r=n(7552),a=n(68446),o=n(36422),s=n(48231),i=n(99546),l=n(87485),c=n(9502);function u(e,t){const n=e.get("tags");return n?n[t]:e.get(t)}function d(e,t){const n=e.get("ALT");if(n)return new Map(n?.map((e=>(0,c.h)(e))).filter(i.notEmpty).map((e=>[e.MatePosition,e]))).get(`${t.get("refName")}:${t.get("start")+1}`)}var g=n(49473);const[f,,m]=[0,1,2,3],p=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:c,showIntraviewLinks:d}=e,p=(0,s.A)(),v=(0,i.getSession)(e),h=(0,o.getSnapshot)(e),{assemblyManager:k}=v,y=k.get(c[0].assemblyNames[0]);(0,g.E6)(h);const E=e.getTrackFeatures(t),T=(0,r.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(E)),[E]),{r:w,g:b,b:N,a:M}=(0,l.M)(p.palette.text.disabled).rgba,S=(0,r.useMemo)((()=>{const n=e.getMatchedFeaturesInLayout(t,T?function(e){const t=new Map,n=new Set;for(const r of e.values()){const e=r.get("flags"),a=r.id(),o=4&e,s=2&e;if(!n.has(a)&&!s&&!o){const e=r.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(r)}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(E):function(e){const t=new Map,n=new Set;for(const r of e.values()){const e=r.id(),a=4&r.get("flags"),o=!!u(r,"SA");if(!n.has(e)&&!a&&o){const e=r.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(r)}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(E));return T||n.forEach((e=>{e.sort(((e,t)=>e.feature.get("clipPos")-t.feature.get("clipPos")))})),n}),[E,t,T,e]),[O,R]=(0,r.useState)();let A=0;if(n.current){const e=n.current.getBoundingClientRect();A=e.top}return y?r.createElement("g",{fill:"none",stroke:`rgb(${w},${b},${N})`,strokeOpacity:M,"data-testid":S.length?`${t}-loaded`:t},S.map((e=>{const n=[];for(let o=0;o<e.length-1;o++){const{layout:s,feature:i,level:l}=e[o],{layout:u,feature:p,level:h}=e[o+1];if(!s||!u)return console.warn("received null layout for a overlay feature"),null;if(!d&&l===h)return null;const k=y.getCanonicalRefName(i.get("refName")),w=y.getCanonicalRefName(p.get("refName"));if(!k||!w)throw new Error(`unable to find ref for ${k||w}`);const b=i.get("strand"),N=p.get("strand"),M=s[-1===b?f:m],S=-1===N,C=T?u[S?f:m]:u[S?m:f],$=(0,g.Tp)(c[l],k,M),L=(0,g.Tp)(c[h],w,C),W=c[l].pxToBp($).reversed,I=c[h].pxToBp(L).reversed,F=c.map((e=>e.getTrack(t))),B=(0,g.Ec)(t,l,c,F,s,a)-A,J=(0,g.Ec)(t,h,c,F,u,a)-A,x=["M",$,B,"C",$+200*i.get("strand")*(W?-1:1),B,L-200*p.get("strand")*(I?-1:1)*(T?-1:1),J,L,J].join(" "),D=`${i.id()}-${p.id()}`;n.push(r.createElement("path",{d:x,key:D,"data-testid":"r1",strokeWidth:O===D?5:1,onClick:()=>{const e=v.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(E.get(i.id())||{toJSON:()=>{}}).toJSON(),feature2:(E.get(p.id())||{toJSON:()=>{}}).toJSON()}});v.showWidget?.(e)},onMouseOver:()=>R(D),onMouseOut:()=>R(void 0)}))}return n}))):null})),[v]=[0,1,2,3],h=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:s}=e,l=(0,i.getSession)(e),{assemblyManager:u}=l,f=e.getTrackFeatures(t),m=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,n=new Set;for(const r of e.values()){if(!n.has(r.id())&&"breakend"===r.get("type")){const e=r.get("ALT");e?.forEach((e=>{const n=`${r.get("refName")}:${r.get("start")+1}`,a=(0,c.h)(e);if(a){const e=t.get(n);e?e.push(r):t.set(a.MatePosition||"none",[r])}}))}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(f))),[f,t,e]),[p,h]=(0,r.useState)(),k=(0,o.getSnapshot)(e);(0,g.E6)(k);const y=u.get(s[0].assemblyNames[0]);if(!y)return null;let E=0;if(n.current){const e=n.current.getBoundingClientRect();E=e.top}return r.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":m.length?`${t}-loaded`:t},m.map((e=>{const n=[];for(let o=0;o<e.length-1;o+=1){const{layout:i,feature:c,level:u}=e[o],{layout:m,feature:k,level:T}=e[o+1],w=c.id(),b=d(c,k);if(!i||!m)return null;const N=c.get("refName"),M=k.get("refName"),S=y.getCanonicalRefName(N),O=y.getCanonicalRefName(M);if(!S||!O)throw new Error(`unable to find ref for ${S||O}`);const R=(0,g.Tp)(s[u],S,i[v]),A=(0,g.Tp)(s[T],O,m[v]),C=s[u].pxToBp(R).reversed,$=s[T].pxToBp(A).reversed,L=s.map((e=>e.getTrack(t))),W=(0,g.Ec)(t,u,s,L,i,a)-E,I=(0,g.Ec)(t,T,s,L,m,a)-E;if(b){const e=["M",R-20*("left"===b.Join?-1:1)*(C?-1:1),W,"L",R,W,"L",A,I,"L",A-20*("left"===b.MateDirection?1:-1)*($?-1:1),I].join(" ");n.push(r.createElement("path",{d:e,"data-testid":"r2",key:JSON.stringify(e),strokeWidth:w===p?10:5,onClick:()=>{const e=l.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:f.get(w)?.toJSON()});l.showWidget?.(e)},onMouseOver:()=>h(w),onMouseOut:()=>h(void 0)}))}else console.warn("the relevant ALT allele was not found, cannot render")}return n})))})),[k]=[0,1,2,3];function y(e){return"+"===e?1:"-"===e?-1:0}const E=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:s}=e,l=(0,i.getSession)(e),{assemblyManager:c}=l,u=e.getTrackFeatures(t),d=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],n=new Set;for(const r of e.values())n.has(r.id())||"<TRA>"!==r.get("ALT")[0]||t.push([r]),n.add(r.id());return t}(u))),[u,t,e]),[f,m]=(0,r.useState)(),p=(0,o.getSnapshot)(e);if((0,g.E6)(p),!c.get(s[0].assemblyNames[0]))return null;let v=0;if(n.current){const e=n.current.getBoundingClientRect();v=e.top}return s.length<2?null:r.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":d.length?`${t}-loaded`:t},d.map((e=>{const n=[];for(const{layout:o,feature:i,level:c}of e){const e=0===c?1:0,d=i.id();if(!o)return null;const p=i.get("INFO"),h=p.CHR2[0],E=p.END[0],T=p.STRANDS?.[0]?.split(""),[w,b]=T??[".","."],N=(0,g.Tp)(s[e],h,E);if(N){const p=[N,0,N+1,0],h=(0,g.Tp)(s[c],i.get("refName"),o[k]),E=N,T=s[c].pxToBp(h).reversed,M=s[e].pxToBp(E).reversed,S=s.map((e=>e.getTrack(t))),O=(0,g.Ec)(t,c,s,S,o,a)-v,R=(0,g.Ec)(t,e,s,S,p,a)-v,A=["M",h-20*y(w)*(T?-1:1),O,"L",h,O,"L",E,R,"L",E-20*y(b)*(M?-1:1),R].join(" ");n.push(r.createElement("path",{d:A,key:JSON.stringify(A),strokeWidth:d===f?10:5,onClick:()=>{const e=l.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(u.get(d)||{toJSON:()=>{}}).toJSON()});l.showWidget?.(e)},onMouseOver:()=>m(d),onMouseOut:()=>m(void 0)}))}}return n})))})),T=(0,a.observer)((function(e){const{model:t,trackId:n}=e,a=t.getMatchedTracks(n);return"AlignmentsTrack"===a[0]?.type?r.createElement(p,e):"VariantTrack"===a[0]?.type?t.hasTranslocations(n)?r.createElement(E,e):r.createElement(h,e):null}))}}]);
//# sourceMappingURL=7348.81b3cb0d.chunk.js.map