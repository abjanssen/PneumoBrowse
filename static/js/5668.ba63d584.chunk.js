"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5668],{35723:(e,t,a)=>{a.d(t,{A:()=>y});var r=a(7552),n=a(68446),o=a(36422),s=a(48231),l=a(99546),i=a(87485),c=a(9502);function u(e,t){const a=e.get("tags");return a?a[t]:e.get(t)}function f(e,t){const a=e.get("ALT");if(a)return new Map(a?.map((e=>(0,c.h)(e))).filter(l.notEmpty).map((e=>[e.MatePosition,e]))).get(`${t.get("refName")}:${t.get("start")+1}`)}var d=a(49473);const[g,,m]=[0,1,2,3],h=(0,n.observer)((function({model:e,trackId:t,parentRef:a,getTrackYPosOverride:n}){const{views:c,showIntraviewLinks:f}=e,h=(0,s.A)(),p=(0,l.getSession)(e),k=(0,o.getSnapshot)(e),{assemblyManager:v}=p,w=v.get(c[0].assemblyNames[0]);(0,d.E6)(k);const E=e.getTrackFeatures(t),y=(0,r.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(E)),[E]),{r:T,g:S,b,a:M}=(0,i.M)(h.palette.text.disabled).rgba,N=(0,r.useMemo)((()=>{const a=e.getMatchedFeaturesInLayout(t,y?function(e){const t=new Map,a=new Set;for(const r of e.values()){const e=r.get("flags"),n=r.id(),o=4&e,s=2&e;if(!a.has(n)&&!s&&!o){const e=r.get("name");let a=t.get(e);a||(a=[],t.set(e,a)),a.push(r)}a.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(E):function(e){const t=new Map,a=new Set;for(const r of e.values()){const e=r.id(),n=4&r.get("flags"),o=!!u(r,"SA");if(!a.has(e)&&!n&&o){const e=r.get("name");let a=t.get(e);a||(a=[],t.set(e,a)),a.push(r)}a.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(E));return y||a.forEach((e=>{e.sort(((e,t)=>e.feature.get("clipPos")-t.feature.get("clipPos")))})),a}),[E,t,y,e]),[x,O]=(0,r.useState)();let $=0;if(a.current){const e=a.current.getBoundingClientRect();$=e.top}return w?r.createElement("g",{fill:"none",stroke:`rgb(${T},${S},${b})`,strokeOpacity:M,"data-testid":N.length?`${t}-loaded`:t},N.map((e=>{const a=[];for(let o=0;o<e.length-1;o++){const{layout:s,feature:l,level:i}=e[o],{layout:u,feature:h,level:k}=e[o+1];if(!s||!u)return console.warn("received null layout for a overlay feature"),null;if(!f&&i===k)return null;const v=w.getCanonicalRefName(l.get("refName")),T=w.getCanonicalRefName(h.get("refName"));if(!v||!T)throw new Error(`unable to find ref for ${v||T}`);const S=l.get("strand"),b=h.get("strand"),M=s[-1===S?g:m],N=-1===b,L=y?u[N?g:m]:u[N?m:g],R=(0,d.Tp)(c[i],v,M),A=(0,d.Tp)(c[k],T,L),W=c[i].pxToBp(R).reversed,C=c[k].pxToBp(A).reversed,I=c.map((e=>e.getTrack(t))),B=(0,d.Ec)(t,i,c,I,s,n)-$,F=(0,d.Ec)(t,k,c,I,u,n)-$,J=["M",R,B,"C",R+200*l.get("strand")*(W?-1:1),B,A-200*h.get("strand")*(C?-1:1)*(y?-1:1),F,A,F].join(" "),P=`${l.id()}-${h.id()}`;a.push(r.createElement("path",{d:J,key:P,"data-testid":"r1",strokeWidth:x===P?5:1,onClick:()=>{const e=p.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(E.get(l.id())||{toJSON:()=>{}}).toJSON(),feature2:(E.get(h.id())||{toJSON:()=>{}}).toJSON()}});p.showWidget?.(e)},onMouseOver:()=>O(P),onMouseOut:()=>O(void 0)}))}return a}))):null})),[p]=[0,1,2,3],k=(0,n.observer)((function({model:e,trackId:t,parentRef:a,getTrackYPosOverride:n}){const{views:s}=e,i=(0,l.getSession)(e),{assemblyManager:u}=i,g=e.getTrackFeatures(t),m=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,a=new Set;for(const r of e.values()){if(!a.has(r.id())&&"breakend"===r.get("type")){const e=r.get("ALT");e?.forEach((e=>{const a=`${r.get("refName")}:${r.get("start")+1}`,n=(0,c.h)(e);if(n){const e=t.get(a);e?e.push(r):t.set(n.MatePosition||"none",[r])}}))}a.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(g))),[g,t,e]),[h,k]=(0,r.useState)(),v=(0,o.getSnapshot)(e);(0,d.E6)(v);const w=u.get(s[0].assemblyNames[0]);if(!w)return null;let E=0;if(a.current){const e=a.current.getBoundingClientRect();E=e.top}return r.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":m.length?`${t}-loaded`:t},m.map((e=>{const a=[];for(let o=0;o<e.length-1;o+=1){const{layout:l,feature:c,level:u}=e[o],{layout:m,feature:v,level:y}=e[o+1],T=c.id(),S=f(c,v);if(!l||!m)return null;const b=c.get("refName"),M=v.get("refName"),N=w.getCanonicalRefName(b),x=w.getCanonicalRefName(M);if(!N||!x)throw new Error(`unable to find ref for ${N||x}`);const O=(0,d.Tp)(s[u],N,l[p]),$=(0,d.Tp)(s[y],x,m[p]),L=s[u].pxToBp(O).reversed,R=s[y].pxToBp($).reversed,A=s.map((e=>e.getTrack(t))),W=(0,d.Ec)(t,u,s,A,l,n)-E,C=(0,d.Ec)(t,y,s,A,m,n)-E;if(S){const e=["M",O-20*("left"===S.Join?-1:1)*(L?-1:1),W,"L",O,W,"L",$,C,"L",$-20*("left"===S.MateDirection?1:-1)*(R?-1:1),C].join(" ");a.push(r.createElement("path",{d:e,"data-testid":"r2",key:JSON.stringify(e),strokeWidth:T===h?10:5,onClick:()=>{const e=i.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:g.get(T)?.toJSON()});i.showWidget?.(e)},onMouseOver:()=>k(T),onMouseOut:()=>k(void 0)}))}else console.warn("the relevant ALT allele was not found, cannot render")}return a})))})),[v]=[0,1,2,3];function w(e){return"+"===e?1:"-"===e?-1:0}const E=(0,n.observer)((function({model:e,trackId:t,parentRef:a,getTrackYPosOverride:n}){const{views:s}=e,i=(0,l.getSession)(e),{assemblyManager:c}=i,u=e.getTrackFeatures(t),f=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],a=new Set;for(const r of e.values())a.has(r.id())||"<TRA>"!==r.get("ALT")[0]||t.push([r]),a.add(r.id());return t}(u))),[u,t,e]),[g,m]=(0,r.useState)(),h=(0,o.getSnapshot)(e);if((0,d.E6)(h),!c.get(s[0].assemblyNames[0]))return null;let p=0;if(a.current){const e=a.current.getBoundingClientRect();p=e.top}return s.length<2?null:r.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":f.length?`${t}-loaded`:t},f.map((e=>{const a=[];for(const{layout:o,feature:l,level:c}of e){const e=0===c?1:0,f=l.id();if(!o)return null;const h=l.get("INFO"),k=h.CHR2[0],E=h.END[0],y=h.STRANDS?.[0]?.split(""),[T,S]=y??[".","."],b=(0,d.Tp)(s[e],k,E);if(b){const h=[b,0,b+1,0],k=(0,d.Tp)(s[c],l.get("refName"),o[v]),E=b,y=s[c].pxToBp(k).reversed,M=s[e].pxToBp(E).reversed,N=s.map((e=>e.getTrack(t))),x=(0,d.Ec)(t,c,s,N,o,n)-p,O=(0,d.Ec)(t,e,s,N,h,n)-p,$=["M",k-20*w(T)*(y?-1:1),x,"L",k,x,"L",E,O,"L",E-20*w(S)*(M?-1:1),O].join(" ");a.push(r.createElement("path",{d:$,key:JSON.stringify($),strokeWidth:f===g?10:5,onClick:()=>{const e=i.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(u.get(f)||{toJSON:()=>{}}).toJSON()});i.showWidget?.(e)},onMouseOver:()=>m(f),onMouseOut:()=>m(void 0)}))}}return a})))})),y=(0,n.observer)((function(e){const{model:t,trackId:a}=e,n=t.getMatchedTracks(a);return"AlignmentsTrack"===n[0]?.type?r.createElement(h,e):"VariantTrack"===n[0]?.type?t.hasTranslocations(a)?r.createElement(E,e):r.createElement(k,e):null}))},95668:(e,t,a)=>{a.d(t,{renderToSvg:()=>h});var r=a(7552),n=a(42489),o=a(99546),s=a(48407),l=a(48735),i=a(36422),c=a(68666),u=a(48231);function f({width:e,height:t,shift:a}){const n=(0,u.A)();return r.createElement("rect",{width:e+2*a,height:t,fill:(0,o.stripAlpha)(n.palette.background.default)})}var d=a(35723),g=a(91468);function m(e,t,a=0){const r={};let n=t;for(const o of e.tracks)r[o.configuration.trackId]=n+a,n+=o.displays[0].height+t;return r}async function h(e,t){const{textHeight:a=18,headerHeight:u=30,rulerHeight:h=30,fontSize:p=13,trackLabels:k="offset",Wrapper:v=(({children:e})=>e),themeName:w="default"}=t,{createRootFn:E}=(0,i.getRoot)(e),y=(0,o.getSession)(e),T=y.allThemes?.()[w],{width:S,views:b}=e,M=u+h,N=b.map((e=>(0,c.mJ)(e.tracks,a,k)+M)),x=(0,o.sum)(N)+100,O=await Promise.all(b.map((async e=>({view:e,data:await Promise.all(e.tracks.map((async e=>{const a=e.displays[0];return await(0,n.when)((()=>void 0===a.ready||a.ready)),{track:e,result:await a.renderSvg({...t,theme:T})}})))})))),$=function(e,t,a){return(0,o.max)(e.flatMap((e=>e.tracks.map((e=>(0,o.measureText)((0,g.getTrackName)(e.configuration,a),t))))),0)}(b,p,y)+40,L="left"===k?$:0,R="offset"===k?a:0,A=[m(b[0],R,p+M),m(b[1],R,p+N[0]+M)],W=S+L,C=(0,l.createJBrowseTheme)(T);return(0,o.renderToStaticMarkup)(r.createElement(s.A,{theme:C},r.createElement(v,null,r.createElement("svg",{width:S,height:x,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,W+100,x].toString()},r.createElement(f,{width:W,height:x,shift:50}),r.createElement("g",{transform:`translate(50 ${p})`},r.createElement("g",{transform:`translate(${L})`},r.createElement("text",{x:0,fontSize:p,fill:C.palette.text.primary},b[0].assemblyNames.join(", ")),r.createElement(c.$m,{model:O[0].view,fontSize:p})),r.createElement(c.zh,{textHeight:a,trackLabels:k,fontSize:p,model:O[0].view,displayResults:O[0].data,offset:M,trackLabelOffset:L})),r.createElement("g",{transform:`translate(50 ${p+N[0]})`},r.createElement("g",{transform:`translate(${L})`},r.createElement("text",{x:0,fontSize:p,fill:C.palette.text.primary},b[1].assemblyNames.join(", ")),r.createElement(c.$m,{model:O[1].view,fontSize:p})),r.createElement(c.zh,{textHeight:a,trackLabels:k,fontSize:p,model:O[1].view,displayResults:O[1].data,offset:M,trackLabelOffset:L})),r.createElement("defs",null,r.createElement("clipPath",{id:"clip-bsv"},r.createElement("rect",{x:0,y:0,width:S,height:x}))),r.createElement("g",{transform:`translate(${L+50})`,clipPath:"url(#clip-bsv)"},e.matchedTracks.map((t=>r.createElement(d.A,{parentRef:{current:null},key:t.configuration.trackId,model:e,trackId:t.configuration.trackId,getTrackYPosOverride:(e,t)=>A[t][e]}))))))),E)}}}]);
//# sourceMappingURL=5668.ba63d584.chunk.js.map